name: build-staging
on:
  push:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:

      - name: set url
 
        id: url
        run: |
          echo buildLog=$'teste https://expo.dev/artifacts/f0cdab10-6f80-47b0-a796-d60a630c753b'
          $buildLog | awk 'NF>1{print $NF}'
          echo url=$($buildLog | awk 'NF>1{print $NF}')
          echo "::set-output name=URL::$(url)"
        shell: bash

      - name: 'Call API'
        uses: actionsflow/axios@v1
        id: api
        with:
          url: ${{ secrets.WEBHOOK_DISCORD }}
          method: 'POST'
          headers: '{ "Content-Type": "application/json" }'
          data: '{ "username": "Peppe: O entregador",  "content": "Novo apk dispon√≠vel: <<<${{ steps.url.outputs.URL }}>>>", "avatar_url": "https://user-images.githubusercontent.com/59540379/162231456-9f0554ab-d465-4632-ac2f-3121347383d3.png" }'

      - run: echo ${{ steps.api.outputs.status }}
      - run: echo ${{ steps.api.outputs.data }}
      - run: echo ${{ steps.api.outputs.headers }}
