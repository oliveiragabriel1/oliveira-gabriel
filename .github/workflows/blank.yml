name: build-staging
on:
  push:
    branches:
      - staging
jobs:
  build:
    runs-on: ubuntu-latest
    steps:

      - name: üöÄ Build app
        run: | 
        echo buildLog="/home/runner/work/CASPAR.BANK.APP/CASPAR.BANK.APP/src/hooks /home/runner/work/CASPAR.BANK.APP/CASPAR.BANK.APP/src/index.tsx /home/runner/work/CASPAR.BANK.APP/CASPAR.BANK.APP/src/interfaces /home/runner/work/CASPAR.BANK.APP/CASPAR.BANK.APP/src/pages /home/runner/work/CASPAR.BANK.APP/CASPAR.BANK.APP/src/routes /home/runner/work/CASPAR.BANK.APP/CASPAR.BANK.APP/src/services /home/runner/work/CASPAR.BANK.APP/CASPAR.BANK.APP/src/store [15:09:33] [15:09:33] Uploading JavaScript bundles [15:09:35] Publish complete [15:09:35] üìù Manifest: https://exp.host/@luby/CasparBank/index.exp?release-channel=development&sdkVersion=43.0.0 Learn more: https://expo.fyi/manifest-url [15:09:35] Checking if this build already exists... [15:09:36] Build started, it may take a few minutes to complete. [15:09:36] You can check the queue length at https://expo.dev/turtle-status [15:09:36] You can monitor the build at https://expo.dev/accounts/luby/projects/CasparBank/builds/a76785a2-6891-4bdd-ac2c-ad042dfdf9fe [15:09:36] Waiting for build to complete. You can press Ctrl+C to exit. It won't cancel the build, you'll be able to monitor it at the printed URL. [15:14:08] Successfully built standalone app: https://expo.dev/artifacts/f0cdab10-6f80-47b0-a796-d60a630c753b"
        
      - name: set url
 
        id: url
        run: |
          URL=$(echo $buildLog | awk 'NF>1{print $NF}')
          echo URL
          echo "::set-output name=URL::$(URL)"
        shell: bash

      - name: 'Call API'
        uses: actionsflow/axios@v1
        id: api
        with:
          url: ${{ secrets.WEBHOOK_DISCORD }}
          method: 'POST'
          headers: '{ "Content-Type": "application/json" }'
          data: '{ "username": "Peppe: O entregador",  "content": "Novo apk dispon√≠vel: <<<${{ steps.url.outputs.URL }}>>>", "avatar_url": "https://user-images.githubusercontent.com/59540379/162231456-9f0554ab-d465-4632-ac2f-3121347383d3.png" }'

      - run: echo ${{ steps.api.outputs.status }}
      - run: echo ${{ steps.api.outputs.data }}
      - run: echo ${{ steps.api.outputs.headers }}
